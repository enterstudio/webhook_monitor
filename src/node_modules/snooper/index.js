var all_sockets = null;

exports.set_sockets = function  (sockets) {
    all_sockets = sockets;
};

exports.connect_snooper = function  (config) {

    config.socket.emit('connected', {message: 'Connected to webhook monitor. Join a room.'});
    
//    config.socket.on('webhook', function  (data) {
//        all_sockets.emit('webhook', {message: config.username + ' says: ' + data.message});
//    });
    
    
    config.socket.on('join', function  (data) {
        //console.log('Got Join: ' + data);
        console.log(config.socket.handshake.address);
        console.log(new Date() + ' ' + config.socket.handshake.address.address + ':' + config.socket.handshake.address.port + ' joined ' + data.message);
        config.socket.join(data.message);
    });
};

exports.failure = function  (socket) {
    console.log(new Date() + socket.handshake.address + ' error');
    socket.emit('error', {message: 'Please login to the webhook viewer.'});
};
